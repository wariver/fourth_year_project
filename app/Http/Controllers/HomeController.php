<?php

namespace App\Http\Controllers;

use App\Device;
use App\Map;
use FarhanWazir\GoogleMaps\GMaps;

class HomeController extends Controller
{
    /**
     * Create a new controller instance.
     *
     * @return void
     */
    public function __construct()
    {
        $this->middleware('auth');
    }

    /**
     * Show the application dashboard.
     *
     * @return \Illuminate\Http\Response
     */
    public function index()
    {

        $maps = Map::all();
        $device = Device::all();

        $gmap = new GMaps();

        foreach ($maps as $map) {

            $config = array();
            $config['center'] = $map->latitude . ',' . $map->longitude;
            $config['map_height'] = '500px';
            $config['scrollwheel'] = true;

            $config['styles'] = array(
                array('name' => 'Red Parks', 'definition' => array(
                    array('featureType' => 'all', 'stylers' => array(array('saturation' => '-30'))),
                    array('featureType' => 'poi.park', 'stylers' => array(array('saturation' => '10'), array('hue' => '#990000')))
                )),
                array('name' => 'Black Roads', 'definition' => array(
                    array('featureType' => 'all', 'stylers' => array(array('saturation' => '-70'))),
                    array('featureType' => 'road.arterial', 'elementType' => 'geometry', 'stylers' => array(array('hue' => '#000000')))
                )),
                array('name' => 'No Businesses', 'definition' => array(
                    array('featureType' => 'poi.business', 'elementType' => 'labels', 'stylers' => array(array('visibility' => 'off')))
                ))
            );

            $config['stylesAsMapTypes'] = true;
            $config['stylesAsMapTypesDefault'] = 'No Businesses';
            $config['trafficOverlay'] = TRUE;
            $config['bicyclingOverlay'] = TRUE;
            $config['zoom'] = 'auto';

            $config['onzoomchanged'] = '

            var zoom = map.getZoom();

            for (i = 0; i < markers_map.length; i++) {
                markers_map[i].setVisible(zoom >= 14);
            }

            console.log(zoom)

            ';

            $gmap->initialize($config);

            //Add Marker
            $marker['position'] = $map->latitude . ',' . $map->longitude;
            $marker['infowindow_content'] = '<h3>' . $map->title . '</h3>' . $map->description;
//            $marker['icon'] = url('/category/media/' . $map->category->icon);

            $gmap->add_marker($marker);
        }

        $map = $gmap->create_map();

        return view('home', compact('map', 'device'));
    }

    public function cat($id)
    {
        $category = Category::findOrFail($id);

        $gmap = new GMaps();

        foreach ($category->maps as $map) {

            $config = array();
            $config['center'] = $map->latitude . ',' . $map->longitude;
            $config['map_height'] = '500px';
            $config['scrollwheel'] = true;

            $config['styles'] = array(
                array('name' => 'Red Parks', 'definition' => array(
                    array('featureType' => 'all', 'stylers' => array(array('saturation' => '-30'))),
                    array('featureType' => 'poi.park', 'stylers' => array(array('saturation' => '10'), array('hue' => '#990000')))
                )),
                array('name' => 'Black Roads', 'definition' => array(
                    array('featureType' => 'all', 'stylers' => array(array('saturation' => '-70'))),
                    array('featureType' => 'road.arterial', 'elementType' => 'geometry', 'stylers' => array(array('hue' => '#000000')))
                )),
                array('name' => 'No Businesses', 'definition' => array(
                    array('featureType' => 'poi.business', 'elementType' => 'labels', 'stylers' => array(array('visibility' => 'off')))
                ))
            );

            $config['stylesAsMapTypes'] = true;
            $config['stylesAsMapTypesDefault'] = 'No Businesses';
            $config['trafficOverlay'] = TRUE;
            $config['bicyclingOverlay'] = TRUE;
            $config['zoom'] = 'auto';

            $config['onzoomchanged'] = '

            var zoom = map.getZoom();

            for (i = 0; i < markers_map.length; i++) {
                markers_map[i].setVisible(zoom >= 14);
            }

            console.log(zoom)

            ';

            $gmap->initialize($config);

            //Add Marker
            $marker['position'] = $map->latitude . ',' . $map->longitude;
            $marker['infowindow_content'] = '<h3>' . $map->title . '</h3>' . $map->description;
            $marker['icon'] = url('/category/media/' . $category->icon);

            $gmap->add_marker($marker);
        }

        $map = $gmap->create_map();

        return view('category.show', compact('map', 'category'));
    }

    public function trip()
    {

        $data = array();
        $find = null;
        $latitude = null;
        $latitude2 = null;
        $longitude = null;
        $longitude2 = null;
        $formatted_address = null;

        if (isset($_GET['find'])) {
            $data = array();

            // Parametros de Configuracion
            $api_key = 'AIzaSyBi8kuwFFclm8Hn7NkMziyh_TbLTxNa_EY'; // API Key Google Maps

            $find = urlencode(trim($_GET['find']));

            // Webservices
            $google_maps_url = "https://maps.googleapis.com/maps/api/geocode/json?address=" . $find . "&key=" . $api_key;
            $google_maps_json = file_get_contents($google_maps_url);
            $google_maps_array = json_decode($google_maps_json, true);

            // Get Location
            $latitude = ($google_maps_array["results"][0]["geometry"]['location']['lat']);
            $longitude = ($google_maps_array["results"][0]["geometry"]['location']['lng']);
            $formatted_address = ($google_maps_array["results"][0]["formatted_address"]);

            $data['latitude'] = $latitude;
            $data['longitude'] = $longitude;
            $data['formatted_address'] = $formatted_address;
            $data['trip'] = ['long' => [36.9190516666667,
                36.9169783333333,
                36.9171,
                36.917105,
                36.9170383333333,
                36.9169783333333,
                36.9169783333333,
                36.9169783333333,
                36.9169783333333,
                36.91697,
                36.917105,
                36.917105,
                36.91697,
                36.9169366666667,
                36.91697,
                36.91697,
                36.9168566666667,
                36.91697,
                36.9169216666667,
                36.9169083333333,
                36.9168033333333,
                36.91673,
                36.91673,
                36.91659,
                36.9165083333333,
                36.9163066666667,
                36.9160616666667,
                36.91582,
                36.9155966666667,
                36.915455,
                36.91529,
                36.91529,
                36.91504,
                36.9146966666667,
                36.9144133333333,
                36.9142766666667,
                36.9141933333333,
                36.9141133333333,
                36.91404,
                36.9139083333333,
                36.9137766666667,
                36.9136616666667,
                36.913515,
                36.91323,
                36.91323,
                36.912885,
                36.9125066666667,
                36.91241,
                36.9118266666667,
                36.9116633333333,
                36.9112033333333,
                36.9106133333333,
                36.9106133333333,
                36.9106766666667,
                36.91062,
                36.9105133333333,
                36.9102733333333,
                36.910165,
                36.9101333333333,
                36.9100566666667,
                36.9097216666667,
                36.90912,
                36.9085,
                36.908055,
                36.9078716666667,
                36.9075316666667,
                36.90706,
                36.90706,
                36.90648,
                36.9050916666667,
                36.9036466666667,
                36.90211,
                36.9012033333333,
                36.899675,
                36.898345,
                36.89721,
                36.89721,
                36.8958016666667,
                36.8942066666667,
                36.8932666666667,
                36.8932666666667,
                36.8924983333333,
                36.8922233333333,
                36.8911683333333,
                36.8911683333333,
                36.89011,
                36.8899066666667,
                36.8900316666667,
                36.89025,
                36.8902883333333,
                36.8903416666667,
                36.89039,
                36.8905066666667,
                36.890455,
                36.890355,
                36.8902983333333,
                36.8903133333333,
                36.8903233333333,
                36.890275,
                36.8901466666667,
                36.8901116666667,
                36.8898866666667,
                36.8898866666667,
                36.889765,
                36.889525,
                36.8887316666667,
                36.8881416666667,
                36.8876316666667,
                36.8871016666667,
                36.8868016666667,
                36.886335,
                36.88619,
                36.8862233333333,
                36.88613,
                36.8857166666667,
                36.8855816666667,
                36.88508,
                36.8843466666667,
                36.8836316666667,
                36.88227,
                36.880565,
                36.8789183333333,
                36.8778383333333,
                36.87677,
                36.8758383333333,
                36.8741883333333,
                36.8722466666667,
                36.8709383333333,
                36.8699433333333,
                36.8690416666667,
                36.868485,
                36.8672283333333,
                36.8657283333333,
                36.8645783333333,
                36.863845,
                36.8633683333333,
                36.8630016666667,
                36.86242,
                36.8621833333333,
                36.8619216666667,
                36.8615116666667,
                36.8610516666667,
                36.8607166666667,
                36.8602233333333,
                36.859685,
                36.8592116666667,
                36.858755,
                36.858305,
                36.8579783333333,
                36.8574516666667,
                36.8572266666667,
                36.8569283333333,
                36.856535,
                36.8562366666667,
                36.8557116666667,
                36.8553733333333,
                36.8550116666667,
                36.8544483333333,
                36.85377,
                36.8530483333333,
                36.8520616666667,
                36.8515033333333,
                36.8509583333333,
                36.8507383333333,
                36.850195,
                36.8496183333333,
                36.8494016666667,
                36.8491216666667,
                36.8484316666667,
                36.8476533333333,
                36.8470133333333,
                36.846495,
                36.846105,
                36.845835,
                36.8453783333333,
                36.8447833333333,
                36.844185,
                36.8436433333333,
                36.84307,
                36.8426766666667,
                36.84212,
                36.8416083333333,
                36.84112,
                36.84063,
                36.84016,
                36.8399,
                36.8395283333333,
                36.839,
                36.8384983333333,
                36.8381383333333,
                36.837745,
                36.8374166666667,
                36.8369066666667,
                36.836035,
                36.83529,
                36.834585,
                36.8334066666667,
                36.834585,
                36.8328783333333,
                36.832555,
                36.8319733333333,
                36.8310416666667,
                36.8293433333333,
                36.8282216666667,
                36.82762,
                36.8272666666667,
                36.8266,
                36.82598,
                36.8254683333333,
                36.824995,
                36.824375,
                36.8240783333333,
                36.8235166666667,
                36.822895,
                36.822225,
                36.8212966666667,
                36.8204416666667,
                36.8199566666667,
                36.819295,
                36.818555,
                36.8179233333333,
                36.81707,
                36.8165066666667,
                36.81616,
                36.81548,
                36.81483,
                36.8146083333333,
                36.8142366666667,
                36.8136483333333,
                36.8129033333333,
                36.8125566666667,
                36.8125883333333,
                36.8128133333333,
                36.8131883333333,
                36.81345,
                36.81386,
                36.81443,
                36.8148533333333,
                36.8148533333333,
                36.8152716666667,
                36.8162533333333,
                36.817035,
                36.817035,
                36.8179766666667,
                36.8188416666667,
                36.8195316666667,
                36.8199866666667,
                36.8202883333333,
                36.8204266666667,
                36.8206733333333,
                36.8208716666667,
                36.8211133333333,
                36.821425,
                36.821425,
                36.821715,
                36.8219633333333,
                36.8219633333333,
                36.8219866666667,
                36.821925,
                36.8219533333333,
                36.8221866666667,
                36.822305,
                36.8226133333333,
                36.8230116666667,
                36.8233383333333,
                36.8234916666667,
                36.823745,
                36.8236333333333,
                36.8234833333333,
                36.8234833333333,
                36.8232233333333,
                36.8229516666667,
                36.822875,
                36.8229783333333,
                36.8229783333333,
                36.8231566666667,
                36.8231566666667,
                36.8234583333333,
                36.823665,
                36.8235816666667,
                36.8236233333333,
                36.8237183333333,
                36.8237833333333,
                36.82376,
                36.823705,
                36.8236966666667,
                36.8237683333333,
                36.823755,
                36.823775,
                36.823905,
                36.8241883333333,
                36.8241883333333,
                36.8246433333333,
                36.8250816666667,
                36.82564,
                36.82564,
                36.8260033333333,
                36.8260033333333,
                36.8262666666667,
                36.826395], 'lat' => [
                -1.23495333333333,
                -1.23619833333333,
                -1.23629666666667,
                -1.23638833333333,
                -1.23645333333333,
                -1.23619833333333,
                -1.23619833333333,
                -1.23619833333333,
                -1.23619833333333,
                -1.23660166666667,
                -1.23638833333333,
                -1.23638833333333,
                -1.23660166666667,
                -1.23680833333333,
                -1.23660166666667,
                -1.23660166666667,
                -1.23696166666667,
                -1.23660166666667,
                -1.23714666666667,
                -1.23717166666667,
                -1.23728333333333,
                -1.23731166666667,
                -1.23731166666667,
                -1.237335,
                -1.23726666666667,
                -1.23717666666667,
                -1.23707666666667,
                -1.23701166666667,
                -1.23688833333333,
                -1.23683666666667,
                -1.23675666666667,
                -1.23675666666667,
                -1.23661833333333,
                -1.23647666666667,
                -1.23639833333333,
                -1.23635833333333,
                -1.23638666666667,
                -1.23637833333333,
                -1.23632666666667,
                -1.23618,
                -1.236095,
                -1.23593333333333,
                -1.23564333333333,
                -1.23504833333333,
                -1.23504833333333,
                -1.23491666666667,
                -1.23475833333333,
                -1.23475833333333,
                -1.23470833333333,
                -1.23463166666667,
                -1.23440333333333,
                -1.23407333333333,
                -1.23407333333333,
                -1.23340833333333,
                -1.23307333333333,
                -1.233,
                -1.23265666666667,
                -1.23238,
                -1.23198,
                -1.23185833333333,
                -1.23158833333333,
                -1.23110333333333,
                -1.23058333333333,
                -1.23021333333333,
                -1.23011833333333,
                -1.230015,
                -1.22997833333333,
                -1.22997833333333,
                -1.23078166666667,
                -1.23140166666667,
                -1.23161166666667,
                -1.23212333333333,
                -1.23266833333333,
                -1.233245,
                -1.23302333333333,
                -1.23235833333333,
                -1.23235833333333,
                -1.23235166666667,
                -1.23232,
                -1.23236833333333,
                -1.23236833333333,
                -1.23288833333333,
                -1.23321333333333,
                -1.23429166666667,
                -1.23429166666667,
                -1.23486,
                -1.23513166666667,
                -1.23565333333333,
                -1.237245,
                -1.238315,
                -1.238955,
                -1.23905833333333,
                -1.23891333333333,
                -1.23898333333333,
                -1.23885333333333,
                -1.23835,
                -1.23819333333333,
                -1.237915,
                -1.23732666666667,
                -1.23639,
                -1.23576166666667,
                -1.235025,
                -1.235025,
                -1.23447166666667,
                -1.23409333333333,
                -1.23310166666667,
                -1.23176666666667,
                -1.230475,
                -1.229145,
                -1.22839833333333,
                -1.22721166666667,
                -1.22628166666667,
                -1.22600666666667,
                -1.22573666666667,
                -1.22550666666667,
                -1.22548333333333,
                -1.22584833333333,
                -1.226345,
                -1.22684833333333,
                -1.22782666666667,
                -1.22905833333333,
                -1.230335,
                -1.23116833333333,
                -1.23196166666667,
                -1.23268166666667,
                -1.23401,
                -1.23569166666667,
                -1.23764166666667,
                -1.23989666666667,
                -1.24191333333333,
                -1.24314,
                -1.24463833333333,
                -1.24623,
                -1.24737333333333,
                -1.2481,
                -1.24857833333333,
                -1.24895,
                -1.24956,
                -1.249815,
                -1.25008666666667,
                -1.25051166666667,
                -1.250995,
                -1.25133833333333,
                -1.25185166666667,
                -1.25239833333333,
                -1.25288166666667,
                -1.25335166666667,
                -1.25380166666667,
                -1.254135,
                -1.25464666666667,
                -1.25491,
                -1.25517,
                -1.25554166666667,
                -1.2558,
                -1.256245,
                -1.256515,
                -1.25682833333333,
                -1.25728833333333,
                -1.257705,
                -1.25801166666667,
                -1.258215,
                -1.25823333333333,
                -1.25823333333333,
                -1.258215,
                -1.25825833333333,
                -1.258265,
                -1.25827166666667,
                -1.25828,
                -1.25829833333333,
                -1.25841333333333,
                -1.25862166666667,
                -1.25884333333333,
                -1.25899833333333,
                -1.259105,
                -1.259295,
                -1.25957,
                -1.25985666666667,
                -1.26011666666667,
                -1.26039,
                -1.260585,
                -1.26091166666667,
                -1.26131833333333,
                -1.26174333333333,
                -1.262125,
                -1.26244166666667,
                -1.26261833333333,
                -1.26283833333333,
                -1.26315,
                -1.26344166666667,
                -1.26366,
                -1.26389666666667,
                -1.26410333333333,
                -1.26441333333333,
                -1.26509833333333,
                -1.26584,
                -1.26661333333333,
                -1.266995,
                -1.26661333333333,
                -1.26710333333333,
                -1.26717666666667,
                -1.26732,
                -1.26752333333333,
                -1.26788166666667,
                -1.26815333333333,
                -1.26827666666667,
                -1.26834833333333,
                -1.268475,
                -1.26859833333333,
                -1.26869666666667,
                -1.26878333333333,
                -1.26886666666667,
                -1.26887666666667,
                -1.26885,
                -1.26881,
                -1.26877166666667,
                -1.26872333333333,
                -1.26888333333333,
                -1.26904666666667,
                -1.26918333333333,
                -1.26921166666667,
                -1.26925833333333,
                -1.26926833333333,
                -1.26943166666667,
                -1.26962666666667,
                -1.27022333333333,
                -1.27114166666667,
                -1.27207,
                -1.27286833333333,
                -1.27344,
                -1.27409833333333,
                -1.27466,
                -1.27491333333333,
                -1.27520666666667,
                -1.27557166666667,
                -1.27582833333333,
                -1.27631666666667,
                -1.27701833333333,
                -1.27741,
                -1.27741,
                -1.27730666666667,
                -1.27724333333333,
                -1.27718333333333,
                -1.27718333333333,
                -1.27764333333333,
                -1.27803166666667,
                -1.27839333333333,
                -1.27863666666667,
                -1.27875166666667,
                -1.27861166666667,
                -1.27809333333333,
                -1.27792166666667,
                -1.27781666666667,
                -1.27784,
                -1.27784,
                -1.278,
                -1.278295,
                -1.278295,
                -1.27864666666667,
                -1.27909,
                -1.27923333333333,
                -1.27944666666667,
                -1.27949666666667,
                -1.27961333333333,
                -1.27975,
                -1.27978,
                -1.27980833333333,
                -1.27987,
                -1.27992333333333,
                -1.27996666666667,
                -1.27996666666667,
                -1.28042666666667,
                -1.28089666666667,
                -1.28102,
                -1.281265,
                -1.281265,
                -1.28133833333333,
                -1.28133833333333,
                -1.28137166666667,
                -1.28137166666667,
                -1.28126833333333,
                -1.28128833333333,
                -1.281435,
                -1.28131833333333,
                -1.28132,
                -1.28127,
                -1.28126666666667,
                -1.281415,
                -1.28137,
                -1.28134,
                -1.28142,
                -1.28143666666667,
                -1.28143666666667,
                -1.28143333333333,
                -1.28140166666667,
                -1.28138666666667,
                -1.28138666666667,
                -1.28158166666667,
                -1.28158166666667,
                -1.2816,
                -1.28158333333333], 'speed' => [
                6.59312,
                3.46324,
                3.9818,
                4.77816,
                6.64868,
                3.46324,
                3.46324,
                3.46324,
                3.46324,
                6.2968,
                4.77816,
                4.77816,
                6.2968,
                5.53748,
                6.2968,
                6.2968,
                2.48168,
                6.2968,
                2.62984,
                3.4262,
                3.96328,
                5.66712,
                5.66712,
                4.68556,
                8.31548,
                6.61164,
                2.48168,
                10.14896,
                8.53772,
                5.59304,
                7.25984,
                7.25984,
                11.27868,
                8.77848,
                10.14896,
                6.46348,
                9.27852,
                11.05644,
                8.13028,
                8.07472,
                3.75956,
                8.90812,
                16.31612,
                18.66816,
                18.66816,
                23.8908,
                15.9272,
                11.3898,
                22.4092,
                25.77984,
                30.13204,
                16.77912,
                16.77912,
                27.89112,
                16.37168,
                16.90876,
                33.85456,
                23.44632,
                19.52008,
                19.77936,
                24.61308,
                37.52152,
                27.27996,
                28.76156,
                24.37232,
                25.26128,
                17.61252,
                17.61252,
                52.18936,
                56.5786,
                56.74528,
                60.69004,
                58.801,
                60.20852,
                51.61524,
                53.02276,
                53.02276,
                58.09724,
                58.65284,
                52.74496,
                52.74496,
                54.76364,
                57.46756,
                52.5968,
                52.5968,
                38.96608,
                30.13204,
                36.8548,
                67.20908,
                51.61524,
                27.26144,
                8.55624,
                3.55584,
                5.7412,
                24.2612,
                25.57612,
                21.55728,
                31.15064,
                34.52128,
                40.79956,
                29.46532,
                30.7432,
                30.7432,
                38.28084,
                47.92976,
                52.26344,
                54.8192,
                53.50428,
                42.0404,
                49.2632,
                51.04112,
                43.02196,
                33.81752,
                29.74312,
                17.94588,
                17.81624,
                35.9288,
                35.50284,
                58.81952,
                72.72804,
                77.45064,
                72.1354,
                37.54004,
                57.00456,
                73.13548,
                91.09988,
                92.45184,
                94.3594,
                82.93256,
                78.11736,
                76.4876,
                80.54348,
                74.74672,
                54.37472,
                26.05764,
                24.42788,
                38.57716,
                17.5014,
                18.81632,
                10.26008,
                22.89072,
                27.5948,
                24.79828,
                25.72428,
                25.50204,
                25.35388,
                23.13148,
                21.00168,
                26.7614,
                21.55728,
                13.22328,
                17.64956,
                13.46404,
                16.89024,
                26.4836,
                18.27924,
                21.9462,
                25.35388,
                28.0578,
                28.09484,
                35.35468,
                27.94668,
                12.72324,
                5.6486,
                29.46532,
                11.51944,
                13.01956,
                21.1128,
                26.854,
                29.31716,
                20.35348,
                17.16804,
                13.50108,
                17.63104,
                18.85336,
                22.09436,
                18.77928,
                21.87212,
                25.81688,
                23.11296,
                26.37248,
                21.90916,
                24.20564,
                17.42732,
                18.53852,
                11.87132,
                16.35316,
                20.48312,
                14.816,
                15.01972,
                19.0756,
                20.05716,
                30.1876,
                38.5216,
                37.63264,
                39.68836,
                39.41056,
                39.68836,
                27.20588,
                15.96424,
                25.90948,
                52.05972,
                68.39436,
                27.83556,
                16.96432,
                24.89088,
                23.68708,
                19.61268,
                17.07544,
                23.09444,
                15.79756,
                18.7052,
                20.96464,
                23.59448,
                27.5022,
                38.11416,
                28.46524,
                26.90956,
                25.79836,
                27.2244,
                22.76108,
                31.1136,
                8.797,
                32.7804,
                40.79956,
                39.04016,
                33.63232,
                32.15072,
                42.00336,
                48.09644,
                36.13252,
                32.39148,
                36.05844,
                23.26112,
                11.37128,
                23.22408,
                36.24364,
                13.6122,
                13.6122,
                24.22416,
                35.651,
                21.16836,
                21.16836,
                37.20668,
                33.03968,
                29.9098,
                25.20572,
                16.26056,
                25.98356,
                32.70632,
                32.00256,
                23.00184,
                15.1864,
                15.1864,
                8.77848,
                19.52008,
                19.52008,
                15.48272,
                19.61268,
                18.2422,
                16.79764,
                11.2046,
                19.7238,
                16.96432,
                7.85248,
                7.35244,
                2.75948,
                5.85232,
                10.4638,
                10.4638,
                15.3716,
                2.4076,
                8.07472,
                17.66808,
                17.66808,
                9.26,
                9.26,
                2.2224,
                8.6118,
                1.14824,
                1.18528,
                2.70392,
                1.14824,
                1.27788,
                1.70384,
                2.0372,
                1.12972,
                1.33344,
                1.68532,
                7.16724,
                16.22352,
                16.22352,
                18.8904,
                19.55712,
                19.2608,
                19.2608,
                11.24164,
                11.24164,
                15.26048,
                16.5754
            ]];
        }
        return view('trip')->with($data);
    }
}
